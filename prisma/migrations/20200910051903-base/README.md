# Migration `20200910051903-base`

This migration has been generated by Farid Esquivel <jovannyrch@gmail.com> at 9/10/2020, 12:19:03 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `bell_db`.`enroll` (
`id` int  NOT NULL  AUTO_INCREMENT,
`userId` int  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`type` ENUM('FREE_TO_PREMIUM', 'PREMIUM_TO_FREE')  NOT NULL DEFAULT 'FREE_TO_PREMIUM',
`method` ENUM('NONE', 'CARD', 'PAYPAL')  NOT NULL DEFAULT 'NONE',
Index `userId`(`userId`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `bell_db`.`group` (
`id` int  NOT NULL  AUTO_INCREMENT,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`creatorId` int  NOT NULL ,
`name` varchar(191)  NOT NULL ,
Index `creatorId`(`creatorId`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `bell_db`.`invitation` (
`id` int  NOT NULL  AUTO_INCREMENT,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`fromId` int  NOT NULL ,
`toId` int  NOT NULL ,
`status` ENUM('ACCEPTED', 'DECLINED', 'WAITING')  NOT NULL DEFAULT 'WAITING',
Index `fromId`(`fromId`),
Index `toId`(`toId`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `bell_db`.`user` (
`id` int  NOT NULL  AUTO_INCREMENT,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`email` varchar(191)  NOT NULL ,
`name` varchar(191)  NOT NULL ,
`password` varchar(191)  NOT NULL ,
`isPremium` boolean  NOT NULL DEFAULT false,
`role` ENUM('USER', 'ADMIN')  NOT NULL DEFAULT 'USER',
`registration` ENUM('EMAIL', 'GOOGLE', 'LINKEDIN', 'FACEBOOK')  NOT NULL DEFAULT 'EMAIL',
UNIQUE Index `user.email_unique`(`email`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `bell_db`.`usersongroups` (
`userId` int  NOT NULL ,
`groupId` int  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`role` ENUM('ADMIN', 'NORMAL')  NOT NULL DEFAULT 'NORMAL',
Index `groupId`(`groupId`),
PRIMARY KEY (`userId`,`groupId`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

ALTER TABLE `bell_db`.`enroll` ADD FOREIGN KEY (`userId`) REFERENCES `bell_db`.`user`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `bell_db`.`group` ADD FOREIGN KEY (`creatorId`) REFERENCES `bell_db`.`user`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `bell_db`.`invitation` ADD FOREIGN KEY (`fromId`) REFERENCES `bell_db`.`user`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `bell_db`.`invitation` ADD FOREIGN KEY (`toId`) REFERENCES `bell_db`.`user`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `bell_db`.`usersongroups` ADD FOREIGN KEY (`groupId`) REFERENCES `bell_db`.`group`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `bell_db`.`usersongroups` ADD FOREIGN KEY (`userId`) REFERENCES `bell_db`.`user`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

DROP TABLE `bell_db`.`_migration`
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200910051903-base
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,106 @@
+generator client {
+    provider = "prisma-client-js"
+}
+
+datasource db {
+    provider = "mysql"
+    url = "***"
+}
+
+model enroll {
+    id        Int           @default(autoincrement()) @id
+    userId    Int
+    createdAt DateTime      @default(now())
+    type      enroll_type   @default(FREE_TO_PREMIUM)
+    method    enroll_method @default(NONE)
+    user      user          @relation(fields: [userId], references: [id])
+
+    @@index([userId], name: "userId")
+}
+
+model group {
+    id            Int             @default(autoincrement()) @id
+    createdAt     DateTime        @default(now())
+    updatedAt     DateTime        @default(now())
+    creatorId     Int
+    name          String
+    user          user            @relation(fields: [creatorId], references: [id])
+    usersongroups usersongroups[]
+
+    @@index([creatorId], name: "creatorId")
+}
+
+model invitation {
+    id                           Int               @default(autoincrement()) @id
+    createdAt                    DateTime          @default(now())
+    fromId                       Int
+    toId                         Int
+    status                       invitation_status @default(WAITING)
+    user_invitation_fromIdTouser user              @relation("invitation_fromIdTouser", fields: [fromId], references: [id])
+    user_invitation_toIdTouser   user              @relation("invitation_toIdTouser", fields: [toId], references: [id])
+
+    @@index([fromId], name: "fromId")
+    @@index([toId], name: "toId")
+}
+
+model user {
+    id                                 Int               @default(autoincrement()) @id
+    createdAt                          DateTime          @default(now())
+    email                              String            @unique
+    name                               String
+    password                           String
+    isPremium                          Boolean           @default(false)
+    role                               user_role         @default(USER)
+    registration                       user_registration @default(EMAIL)
+    enroll                             enroll[]
+    group                              group[]
+    invitation_invitation_fromIdTouser invitation[]      @relation("invitation_fromIdTouser")
+    invitation_invitation_toIdTouser   invitation[]      @relation("invitation_toIdTouser")
+    usersongroups                      usersongroups[]
+}
+
+model usersongroups {
+    userId    Int
+    groupId   Int
+    createdAt DateTime           @default(now())
+    role      usersongroups_role @default(NORMAL)
+    group     group              @relation(fields: [groupId], references: [id])
+    user      user               @relation(fields: [userId], references: [id])
+
+    @@id([userId, groupId])
+    @@index([groupId], name: "groupId")
+}
+
+enum enroll_type {
+    FREE_TO_PREMIUM
+    PREMIUM_TO_FREE
+}
+
+enum enroll_method {
+    NONE
+    CARD
+    PAYPAL
+}
+
+enum invitation_status {
+    ACCEPTED
+    DECLINED
+    WAITING
+}
+
+enum user_role {
+    USER
+    ADMIN
+}
+
+enum user_registration {
+    EMAIL
+    GOOGLE
+    LINKEDIN
+    FACEBOOK
+}
+
+enum usersongroups_role {
+    ADMIN
+    NORMAL
+}
```


